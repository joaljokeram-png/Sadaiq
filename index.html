<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø´Ø§Øª ØµØ¯Ù‰ Ø§Ù„Ø¹Ø±Ø§Ù‚ - Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ ÙˆØ§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ ğŸ‘‘</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --gold: #d4af37; --bg: #000; --dark-grey: #1a1a1a; }
        body { margin: 0; background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; direction: rtl; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }

        /* Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø¹Ù„ÙˆÙŠ */
        .top-nav { display: flex; background: #111; border-bottom: 2px solid var(--gold); }
        .nav-btn { flex: 1; padding: 12px; text-align: center; cursor: pointer; font-weight: bold; }
        .nav-btn.active { background: var(--gold); color: #000; }

        /* Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .main-layout { display: flex; flex: 1; overflow: hidden; }
        .side-panel { width: 280px; background: #0a0a0a; border-left: 1px solid #222; display: flex; flex-direction: column; }
        .chat-area { flex: 1; display: flex; flex-direction: column; background: #111; position: relative; }

        /* Ù†Ø§ÙØ°Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ (Popup) */
        #profile-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #111; border: 2px solid var(--gold); border-radius: 15px; width: 320px; z-index: 2000; display: none; padding: 20px; box-shadow: 0 0 30px #000; }
        .profile-input { width: 100%; background: #222; border: 1px solid #444; color: #fff; padding: 8px; margin-bottom: 10px; border-radius: 5px; }
        .color-picker { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }

        /* Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ */
        #emoji-picker { position: absolute; bottom: 70px; right: 10px; background: #222; border: 1px solid var(--gold); border-radius: 10px; padding: 10px; display: none; grid-template-columns: repeat(5, 1fr); gap: 5px; z-index: 100; }
        .emoji-item { cursor: pointer; font-size: 20px; text-align: center; }

        /* Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        #messages { flex: 1; overflow-y: auto; padding: 15px; }
        .msg { margin-bottom: 10px; padding: 10px; border-radius: 10px; background: #1a1a1a; border-right: 4px solid var(--gold); }
        
        .footer { padding: 12px; background: #000; display: flex; gap: 10px; align-items: center; }
        #msgInp { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #333; background: #1a1a1a; color: #fff; outline: none; }
        .action-btn { background: var(--gold); border: none; padding: 8px 15px; border-radius: 15px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div id="profile-modal">
    <h3 style="text-align:center; color:var(--gold);">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h3>
    <label>Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©:</label>
    <input type="text" id="edit-avatar" class="profile-input" placeholder="http://...">
    <label>Ø±Ø§Ø¨Ø· ØºÙ„Ø§Ù Ø§Ù„Ù…Ù„Ù:</label>
    <input type="text" id="edit-cover" class="profile-input" placeholder="http://...">
    <label>Ø§Ù„Ø­Ø§Ù„Ø© (Status):</label>
    <input type="text" id="edit-status" class="profile-input" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ù…Ø´ØºÙˆÙ„">
    
    <div class="color-picker">
        <label>Ù„ÙˆÙ† Ø§Ù„Ø§Ø³Ù…:</label>
        <input type="color" id="name-color" value="#d4af37">
    </div>
    <div class="color-picker">
        <label>Ù„ÙˆÙ† Ø§Ù„Ø®Ø·:</label>
        <input type="color" id="text-color" value="#ffffff">
    </div>

    <button class="action-btn" style="width:100%; margin-top:10px;" onclick="saveProfile()">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
    <button class="action-btn" style="width:100%; margin-top:5px; background:#444; color:#fff;" onclick="closeProfile()">Ø¥Ù„ØºØ§Ø¡</button>
</div>

<div class="top-nav">
    <div class="nav-btn active" id="tab-users" onclick="switchTab('users')">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</div>
    <div class="nav-btn" id="tab-rooms" onclick="switchTab('rooms')">Ø§Ù„ØºØ±Ù</div>
    <div class="nav-btn" style="color:var(--gold);" onclick="openProfile()">Ù…Ù„ÙÙŠ</div>
</div>

<div class="main-layout">
    <div class="side-panel">
        <div id="list-container" style="padding:10px;"></div>
    </div>
    <div class="chat-area">
        <div id="emoji-picker">
            <span class="emoji-item" onclick="addEmoji('ğŸ˜Š')">ğŸ˜Š</span>
            <span class="emoji-item" onclick="addEmoji('ğŸ˜‚')">ğŸ˜‚</span>
            <span class="emoji-item" onclick="addEmoji('ğŸ˜')">ğŸ˜</span>
            <span class="emoji-item" onclick="addEmoji('ğŸ™„')">ğŸ™„</span>
            <span class="emoji-item" onclick="addEmoji('ğŸ‘‘')">ğŸ‘‘</span>
            <span class="emoji-item" onclick="addEmoji('â¤')">â¤</span>
            <span class="emoji-item" onclick="addEmoji('ğŸŒ¹')">ğŸŒ¹</span>
            <span class="emoji-item" onclick="addEmoji('ğŸ”¥')">ğŸ”¥</span>
        </div>
        <div id="messages"></div>
        <div class="footer">
            <button onclick="toggleEmoji()" style="background:none; border:none; font-size:22px; cursor:pointer;">ğŸ˜Š</button>
            <input type="text" id="msgInp" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©...">
            <button class="action-btn" onclick="sendMsg()">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
    </div>
</div>

<script>
    const socket = io('https://sadaiq.onrender.com');
    
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    let myData = {
        name: "Ø²Ø§Ø¦Ø±_" + Math.floor(Math.random()*100),
        rank: "Ø£ÙˆÙ†Ø±",
        avatar: "https://cdn-icons-png.flaticon.com/512/149/149071.png",
        cover: "",
        status: "Ù…ØªÙˆØ§Ø¬Ø¯",
        nameColor: "#d4af37",
        textColor: "#ffffff"
    };

    socket.emit('join', myData);

    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
    function switchTab(type) {
        const container = document.getElementById('list-container');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        if(type === 'users') {
            document.getElementById('tab-users').classList.add('active');
            // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø³ØªØ­Ø¯Ø« ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
        } else {
            document.getElementById('tab-rooms').classList.add('active');
            container.innerHTML = '<div style="padding:15px; border-bottom:1px solid #222;">ğŸ  Ø§Ù„ØºØ±ÙØ© Ø§Ù„Ø¹Ø§Ù…Ø©</div>';
        }
    }

    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
    function openProfile() { document.getElementById('profile-modal').style.display = 'block'; }
    function closeProfile() { document.getElementById('profile-modal').style.display = 'none'; }
    
    function saveProfile() {
        myData.avatar = document.getElementById('edit-avatar').value || myData.avatar;
        myData.status = document.getElementById('edit-status').value || "Ù…ØªÙˆØ§Ø¬Ø¯";
        myData.nameColor = document.getElementById('name-color').value;
        myData.textColor = document.getElementById('text-color').value;
        
        socket.emit('join', myData); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±
        closeProfile();
        alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…Ù„ÙÙƒ Ø¨Ù†Ø¬Ø§Ø­! âœ…");
    }

    // Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„
    function toggleEmoji() {
        const p = document.getElementById('emoji-picker');
        p.style.display = p.style.display === 'grid' ? 'none' : 'grid';
    }
    function addEmoji(emoji) {
        document.getElementById('msgInp').value += emoji;
        toggleEmoji();
    }

    function sendMsg() {
        const inp = document.getElementById('msgInp');
        if(!inp.value) return;
        socket.emit('message', {
            user: myData.name,
            text: inp.value,
            avatar: myData.avatar,
            nameColor: myData.nameColor,
            textColor: myData.textColor,
            room: "Ø§Ù„Ø¹Ø§Ù…Ø©"
        });
        inp.value = "";
    }

    socket.on('new_message', (data) => {
        const box = document.getElementById('messages');
        box.innerHTML += `
            <div class="msg">
                <img src="${data.avatar}" style="width:35px; height:35px; border-radius:50%; float:right; margin-left:10px;">
                <b style="color:${data.nameColor}">${data.user}</b>: 
                <span style="color:${data.textColor}">${data.text}</span>
            </div>`;
        box.scrollTop = box.scrollHeight;
    });

    socket.on('update_users', (users) => {
        const container = document.getElementById('list-container');
        if(!document.getElementById('tab-users').classList.contains('active')) return;
        container.innerHTML = "";
        users.forEach(u => {
            container.innerHTML += `<div style="padding:8px; border-bottom:1px solid #111;">
                â— <span style="color:var(--gold)">${u.name}</span> <br>
                <small style="color:gray; font-size:11px;">${u.status}</small>
            </div>`;
        });
    });
</script>
</body>
</html>
